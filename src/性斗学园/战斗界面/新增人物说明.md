# 新增人物配置说明

本文档说明三个新增人物（伊甸芙宁、克莉丝汀、艾格妮丝）的完整配置情况。

---

## 一、数据配置完成情况

### 1. enemyDatabase.ts
三个新人物的基础数据已添加到 `ENEMY_DATABASE` 对象中：

- **伊甸芙宁**：等级99，性斗力999，学院最高权限者
- **克莉丝汀**：等级88，性斗力871，女王形态（已统一为单一强力数据）
- **艾格妮丝**：等级42，性斗力403，鼠族公主

### 2. 名称别名映射
在 `NAME_ALIASES` 对象中已添加：
```typescript
'芙宁': '伊甸芙宁',
'伊甸芙宁': '伊甸芙宁',
'克莉丝汀': '克莉丝汀',
'书记': '克莉丝汀',
'艾格妮丝': '艾格妮丝',
'鼠族公主': '艾格妮丝',
'赤蔷薇': '艾格妮丝',
```

### 3. 技能配置
所有技能已添加到 `ENEMY_SKILLS` 对象和 `ENEMY_SKILL_MAP` 映射中。

---

## 二、技能列表

### 伊甸芙宁（16个技能）
水系操控、变装羞辱、体术道具、权限召唤四大类，包括终极技能"Game Over"。

### 克莉丝汀（12个技能）
统一为女王形态的强力技能，包括：幻痛之舞、书记的封印、审判之座、淫蛇束缚、道具处刑、高跟制裁、视觉剥夺、双重奏、震动调教、窒息恩典、绝对领域、慈悲的重压。

### 艾格妮丝（11个技能，性别特化）
- **通用技能**（2个）：费洛蒙茶会、鼠妹近卫队
- **针对女性/伪娘**（4个）：皇室舔足礼、轻轻啃咬、强制贴贴、温柔品鉴
- **针对男性**（5个）：皇室断子绝孙脚、秽物唾弃、鼠尾后庭贯穿、鼠疫口气洗脑、鼠群噬咬

---

## 三、艾格妮丝性别判断机制

### ✅ 已实现
艾格妮丝的性别判断机制已完全实现！系统会在加载敌人数据时自动根据玩家性别选择正确的技能池。

### 技能池配置
```typescript
// 针对女性/非二元玩家的技能池
"艾格妮丝": [
  "艾格妮丝_通用_1",    // 费洛蒙茶会
  "艾格妮丝_通用_2",    // 鼠妹近卫队
  "艾格妮丝_女性_1",    // 皇室舔足礼
  "艾格妮丝_女性_2",    // 轻轻啃咬
  "艾格妮丝_女性_3",    // 强制贴贴
  "艾格妮丝_女性_4",    // 温柔品鉴
],

// 针对男性玩家的技能池
"艾格妮丝_男": [
  "艾格妮丝_通用_1",    // 费洛蒙茶会
  "艾格妮丝_通用_2",    // 鼠妹近卫队
  "艾格妮丝_男性_1",    // 皇室断子绝孙脚
  "艾格妮丝_男性_2",    // 秽物唾弃
  "艾格妮丝_男性_3",    // 鼠尾后庭贯穿
  "艾格妮丝_男性_4",    // 鼠疫口气洗脑
  "艾格妮丝_男性_5",    // 鼠群噬咬
]
```

### 实现逻辑

在 `app.vue` 中加载敌人技能时，系统会自动检测玩家性别：

```typescript
// 特殊处理：艾格妮丝根据玩家性别选择技能池
let skillLookupName = fullEnemyName;
if (fullEnemyName === '艾格妮丝' || fullEnemyName.includes('艾格妮丝')) {
  const playerGender = _.get(mvuData.stat_data, '基础信息.性别', '女');
  if (playerGender === '男') {
    skillLookupName = '艾格妮丝_男';
    console.info(`[战斗界面] 艾格妮丝检测到男性玩家，使用男性技能池`);
  } else {
    skillLookupName = '艾格妮丝';
    console.info(`[战斗界面] 艾格妮丝检测到女性/非二元玩家，使用女性技能池`);
  }
}

const enemySkills = enemySkillDbModule.getEnemySkills(enemyName, skillLookupName);
```

### 工作原理
1. 系统读取玩家性别：`mvuData.stat_data.基础信息.性别`
2. 如果玩家是男性，使用 `艾格妮丝_男` 技能池（通用 + 男性技能）
3. 如果玩家是女性/非二元，使用 `艾格妮丝` 技能池（通用 + 女性技能）
4. 技能自动写入MVU变量，无需额外筛选

---

## 四、使用方法

### 通过对手名字读取数据
```typescript
import { getEnemyMvuData } from './enemyDatabase';
import { getEnemySkills } from './enemySkillDatabase';

// 读取敌人数据
const enemyData = getEnemyMvuData('伊甸芙宁');  // 支持别名
const enemyData2 = getEnemyMvuData('芙宁');     // 也可以

// 读取敌人技能
const skills = getEnemySkills('克莉丝汀');
const skills2 = getEnemySkills('书记');         // 别名也可以

// 读取艾格妮丝技能（返回全部技能，需要在AI中筛选）
const agnesSkills = getEnemySkills('艾格妮丝');
```

### 名称匹配规则
1. **精确匹配**：直接匹配数据库中的完整名称
2. **别名匹配**：通过 `NAME_ALIASES` 映射表匹配
3. **包含匹配**：如果对手名包含某个角色名，返回该角色数据

---

## 五、CG配置状态

**当前状态**：三个新人物暂无CG配置

如需添加CG配置，请在 `cgConfig.ts` 中按照以下格式添加：

```typescript
const 伊甸芙宁Config: CharacterCGConfig = {
  characterName: '伊甸芙宁',
  male: {
    defeat: [ /* 男u战败事件 */ ],
    victory: [ /* 男u战胜事件 */ ]
  },
  female: {
    defeat: [ /* 女u战败事件 */ ],
    victory: [ /* 女u战胜事件 */ ]
  }
};

// 添加到配置数组
export const CG_CONFIGS: CharacterCGConfig[] = [
  // ... 现有配置
  伊甸芙宁Config,
  克莉丝汀Config,
  艾格妮丝Config,
];
```

---

## 六、验证清单

### ✅ 已完成
- [x] 三个新人物的基础数据已添加到 `enemyDatabase.ts`
- [x] 三个新人物的技能已添加到 `enemySkillDatabase.ts`
- [x] 名称别名映射已配置
- [x] 技能映射已配置
- [x] 克莉丝汀已统一为单一强力数据
- [x] 艾格妮丝技能已按性别分类
- [x] **艾格妮丝的性别判断逻辑已在 `app.vue` 中实现**

### ⚠️ 可选
- [ ] 三个新人物的CG配置（如有需要）

---

## 七、测试建议

1. **基础测试**：
   - 使用 `getEnemyMvuData('伊甸芙宁')` 验证数据读取
   - 使用 `getEnemySkills('克莉丝汀')` 验证技能读取
   - 测试别名是否正常工作

2. **艾格妮丝性别测试**：
   - 创建男性角色，与艾格妮丝战斗，观察是否使用男性技能
   - 创建女性角色，与艾格妮丝战斗，观察是否使用女性技能
   - 验证通用技能在两种情况下都能使用

3. **战斗测试**：
   - 测试三个新人物的战斗流程是否正常
   - 验证技能效果是否符合预期
   - 检查数值平衡性

---

## 八、注意事项

1. **艾格妮丝性别判断**：必须在战斗AI中实现性别筛选逻辑，否则会随机使用所有技能
2. **克莉丝汀数据**：已统一为女王形态，无需处理形态切换
3. **伊甸芙宁强度**：作为最高权限者，数值极高，建议作为特殊BOSS使用
4. **技能ID命名**：艾格妮丝的技能ID包含 `_通用_`、`_女性_`、`_男性_` 标识，便于筛选

---

**配置完成日期**：2026-01-12
**配置人员**：Cascade AI Assistant
