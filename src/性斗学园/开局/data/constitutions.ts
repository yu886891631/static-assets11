/**
 * 特殊体质数据库
 * 包含所有初始可选的特殊体质（被动）
 */

import { ConstitutionCategory, ConstitutionData, ConstitutionRarity, TriggerTiming } from './constitution-types';

// 重新导出类型
export { ConstitutionCategory, ConstitutionRarity, TriggerTiming, type ConstitutionData };

// ==================== 通用体质（所有性别可选） ====================

export const COMMON_CONSTITUTIONS: ConstitutionData[] = [
  {
    id: 'c_sensitive',
    name: '敏感体质',
    description: '身体对刺激的反应异常敏锐',
    effectDescription: '基础忍耐力+8%，且闪避率+5',
    icon: 'HeartPulse',
    category: ConstitutionCategory.SENSITIVITY,
    rarity: ConstitutionRarity.COMMON,
    permanentModifiers: [
      { stat: '基础忍耐力成算', value: 8, isPercent: true },
      { stat: '闪避率加成', value: 5, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: ['c_numb'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '每一次触碰都如同电流...',
  },
  {
    id: 'c_numb',
    name: '迟钝体质',
    description: '对快感的感知较为迟钝',
    effectDescription: '受到快感攻击时伤害-15%',
    icon: 'Snowflake',
    category: ConstitutionCategory.SENSITIVITY,
    rarity: ConstitutionRarity.COMMON,
    permanentModifiers: [{ stat: '基础忍耐力成算', value: 15, isPercent: true }],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: ['c_sensitive'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '麻木是保护自己的盔甲...',
  },
  {
    id: 'c_lucky',
    name: '天生幸运',
    description: '总能在关键时刻获得好运',
    effectDescription: '幸运+15，暴击率+8%，但最大快感-20',
    icon: 'Clover',
    category: ConstitutionCategory.SPECIAL,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '幸运加成', value: 15, isPercent: false },
      { stat: '暴击率加成', value: 8, isPercent: true },
      { stat: '最大快感加成', value: -20, isPercent: false },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: ['c_unlucky'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '幸运女神的宠儿~',
  },
  {
    id: 'c_unlucky',
    name: '霉运缠身',
    description: '总在关键时刻掉链子',
    effectDescription: '幸运-15，但性斗力成算+20%',
    icon: 'Skull',
    category: ConstitutionCategory.SPECIAL,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '幸运加成', value: -15, isPercent: false },
      { stat: '基础性斗力成算', value: 20, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: ['c_lucky'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: false,
    hidden: false,
    flavorText: '越是倒霉，越要用实力弥补！',
  },
  {
    id: 'c_stamina',
    name: '持久战士',
    description: '拥有异于常人的持久力',
    effectDescription: '最大耐力+30，忍耐力成算+8%，但魅力-5',
    icon: 'Shield',
    category: ConstitutionCategory.PHYSICAL,
    rarity: ConstitutionRarity.COMMON,
    permanentModifiers: [
      { stat: '最大耐力加成', value: 30, isPercent: false },
      { stat: '基础忍耐力成算', value: 8, isPercent: true },
      { stat: '魅力加成', value: -5, isPercent: false },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '持久才是王道...',
  },
  {
    id: 'c_quick',
    name: '早漏体质',
    description: '难以控制自己的身体',
    effectDescription: '最大快感-15，性斗力成算+12%',
    icon: 'Lightning',
    category: ConstitutionCategory.PHYSICAL,
    rarity: ConstitutionRarity.COMMON,
    permanentModifiers: [
      { stat: '最大快感加成', value: -15, isPercent: false },
      { stat: '基础性斗力成算', value: 12, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: ['c_stamina'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: false,
    hidden: false,
    flavorText: '快攻是最好的防守！',
  },
  {
    id: 'c_charming',
    name: '天生魅惑',
    description: '与生俱来的魅力让人无法抗拒',
    effectDescription: '魅力+20，性斗力成算+5%，但忍耐力成算-8%',
    icon: 'GrinHearts',
    category: ConstitutionCategory.SPECIAL,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '魅力加成', value: 20, isPercent: false },
      { stat: '基础性斗力成算', value: 5, isPercent: true },
      { stat: '基础忍耐力成算', value: -8, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '让人无法移开视线...',
  },
  {
    id: 'c_iron_will',
    name: '钢铁意志',
    description: '坚不可摧的精神力量',
    effectDescription: '基础忍耐力+5，忍耐力成算+8%',
    icon: 'Brain',
    category: ConstitutionCategory.MENTAL,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '基础忍耐力加成', value: 5, isPercent: false },
      { stat: '基础忍耐力成算', value: 8, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: ['c_weak_mind'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '无论如何都不会屈服！',
  },
  {
    id: 'c_weak_mind',
    name: '意志薄弱',
    description: '精神容易被击溃',
    effectDescription: '最大快感-20，魅力+10，闪避率+8%',
    icon: 'Ghost',
    category: ConstitutionCategory.MENTAL,
    rarity: ConstitutionRarity.COMMON,
    permanentModifiers: [
      { stat: '最大快感加成', value: -20, isPercent: false },
      { stat: '魅力加成', value: 10, isPercent: false },
      { stat: '闪避率加成', value: 8, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: ['c_iron_will'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: false,
    hidden: false,
    flavorText: '躲避是最好的防御...',
  },
  {
    id: 'c_exhibitionist',
    name: '露出癖',
    description: '被注视时会异常兴奋',
    effectDescription: '性斗力成算+8%，忍耐力成算-5%',
    icon: 'Eye',
    category: ConstitutionCategory.TENDENCY,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '基础性斗力成算', value: 8, isPercent: true },
      { stat: '基础忍耐力成算', value: -5, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '越多人看越兴奋...',
  },
  {
    id: 'c_masochist',
    name: 'M体质',
    description: '从痛苦和羞耻中获得快感',
    effectDescription: '忍耐力成算-8%，性斗力成算+8%',
    icon: 'HeartBroken',
    category: ConstitutionCategory.TENDENCY,
    rarity: ConstitutionRarity.COMMON,
    permanentModifiers: [
      { stat: '基础忍耐力成算', value: -8, isPercent: true },
      { stat: '基础性斗力成算', value: 8, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: ['c_sadist'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '请...更多...',
  },
  {
    id: 'c_sadist',
    name: 'S体质',
    description: '从支配他人中获得力量',
    effectDescription: '暴击率+8%，性斗力成算+5%',
    icon: 'Crown',
    category: ConstitutionCategory.TENDENCY,
    rarity: ConstitutionRarity.COMMON,
    permanentModifiers: [
      { stat: '暴击率加成', value: 8, isPercent: true },
      { stat: '基础性斗力成算', value: 5, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: ['c_masochist'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '服从于我！',
  },
  {
    id: 'c_energy_overflow',
    name: '能量溢出',
    description: '体内能量异常充沛',
    effectDescription: '性斗力加成+8，忍耐力加成+5，但最大快感-10',
    icon: 'Zap',
    category: ConstitutionCategory.SPECIAL,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '基础性斗力加成', value: 8, isPercent: false },
      { stat: '基础忍耐力加成', value: 5, isPercent: false },
      { stat: '最大快感加成', value: -10, isPercent: false },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '力量源源不断...',
  },
  {
    id: 'c_adaptive_body',
    name: '适应之躯',
    description: '身体能快速适应各种刺激',
    effectDescription: '闪避率+6%，魅力+5，但性斗力成算-3%',
    icon: 'Shield',
    category: ConstitutionCategory.PHYSICAL,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '闪避率加成', value: 6, isPercent: true },
      { stat: '魅力加成', value: 5, isPercent: false },
      { stat: '基础性斗力成算', value: -3, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '身体会记住每一次战斗...',
  },
  {
    id: 'c_lust_amplifier',
    name: '快感放大器',
    description: '对快感的感知异常敏锐',
    effectDescription: '性斗力成算+6%，幸运+8，但忍耐力成算-6%',
    icon: 'HeartPulse',
    category: ConstitutionCategory.SENSITIVITY,
    rarity: ConstitutionRarity.EPIC,
    permanentModifiers: [
      { stat: '基础性斗力成算', value: 6, isPercent: true },
      { stat: '幸运加成', value: 8, isPercent: false },
      { stat: '基础忍耐力成算', value: -6, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: ['c_numb'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '每一丝快感都被放大...',
  },
  {
    id: 'c_balanced_warrior',
    name: '平衡战士',
    description: '攻防兼备的完美平衡',
    effectDescription: '性斗力加成+5，忍耐力加成+5，但魅力-3',
    icon: 'Scale',
    category: ConstitutionCategory.SPECIAL,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '基础性斗力加成', value: 5, isPercent: false },
      { stat: '基础忍耐力加成', value: 5, isPercent: false },
      { stat: '魅力加成', value: -3, isPercent: false },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: [],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '完美的平衡才是最强的...',
  },
];

// ==================== 男性专属体质 ====================

export const MALE_CONSTITUTIONS: ConstitutionData[] = [
  {
    id: 'c_iron_cock',
    name: '钢铁巨根',
    description: '坚硬如铁的雄伟器官',
    effectDescription: '性斗力成算+12%，暴击率+5%',
    icon: 'Dumbbell',
    category: ConstitutionCategory.PHYSICAL,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '基础性斗力成算', value: 12, isPercent: true },
      { stat: '暴击率加成', value: 5, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: ['male'],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '坚若磐石...',
  },
  {
    id: 'c_prostate_dev',
    name: '前列腺开发',
    description: '后庭已被完全开发',
    effectDescription: '暴击率+12%，忍耐力成算-8%',
    icon: 'Target',
    category: ConstitutionCategory.SENSITIVITY,
    rarity: ConstitutionRarity.EPIC,
    permanentModifiers: [
      { stat: '暴击率加成', value: 12, isPercent: true },
      { stat: '基础忍耐力成算', value: -8, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: ['male'],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: false,
    hidden: false,
    flavorText: '那里...不行...',
  },
  {
    id: 'c_reload',
    name: '无限子弹',
    description: '惊人的恢复能力',
    effectDescription: '忍耐力成算+10%，最大耐力+20',
    icon: 'Sync',
    category: ConstitutionCategory.RECOVERY,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '基础忍耐力成算', value: 10, isPercent: true },
      { stat: '最大耐力加成', value: 20, isPercent: false },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: ['male'],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '准备好第二回合了吗？',
  },
];

// ==================== 女性专属体质 ====================

export const FEMALE_CONSTITUTIONS: ConstitutionData[] = [
  {
    id: 'c_sensitive_nips',
    name: '乳首开发',
    description: '胸部极为敏感',
    effectDescription: '闪避率+5%，忍耐力成算-6%',
    icon: 'Target',
    category: ConstitutionCategory.SENSITIVITY,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '基础忍耐力成算', value: -6, isPercent: true },
      { stat: '闪避率加成', value: 5, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: ['female'],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: false,
    hidden: false,
    flavorText: '不要碰那里...',
  },
  {
    id: 'c_wet',
    name: '淫乱体质',
    description: '极易动情的身体',
    effectDescription: '魅力+12，最大快感+6',
    icon: 'Droplets',
    category: ConstitutionCategory.SENSITIVITY,
    rarity: ConstitutionRarity.COMMON,
    permanentModifiers: [
      { stat: '魅力加成', value: 12, isPercent: false },
      { stat: '最大快感加成', value: 6, isPercent: false },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: ['female'],
    excludeConstitutions: ['c_dry'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: false,
    hidden: false,
    flavorText: '身体...好热...',
  },
  {
    id: 'c_dry',
    name: '冰山美人',
    description: '难以动情的体质',
    effectDescription: '快感积累-15%，忍耐力成算+12%，最大耐力+20',
    icon: 'Snowflake',
    category: ConstitutionCategory.SENSITIVITY,
    rarity: ConstitutionRarity.RARE,
    permanentModifiers: [
      { stat: '最大耐力加成', value: 20, isPercent: false },
      { stat: '基础忍耐力成算', value: 12, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: ['female'],
    excludeConstitutions: ['c_wet'],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '你以为这就能让我动摇？',
  },
  {
    id: 'c_squirt',
    name: '潮吹体质',
    description: '高潮时会大量喷射',
    effectDescription: '魅力+12，性斗力成算+8%',
    icon: 'Water',
    category: ConstitutionCategory.SPECIAL,
    rarity: ConstitutionRarity.EPIC,
    permanentModifiers: [
      { stat: '魅力加成', value: 12, isPercent: false },
      { stat: '基础性斗力成算', value: 8, isPercent: true },
    ],
    sensitivityModifiers: [],
    triggerEffects: [],
    genderRestriction: ['female'],
    excludeConstitutions: [],
    requireConstitutions: [],
    maxCount: 1,
    isPositive: true,
    hidden: false,
    flavorText: '停不下来了...',
  },
];

// ==================== 导出所有体质 ====================

export const STARTER_CONSTITUTIONS = {
  common: COMMON_CONSTITUTIONS,
  male: MALE_CONSTITUTIONS,
  female: FEMALE_CONSTITUTIONS,
};

export const ALL_CONSTITUTIONS: ConstitutionData[] = [
  ...COMMON_CONSTITUTIONS,
  ...MALE_CONSTITUTIONS,
  ...FEMALE_CONSTITUTIONS,
];

/** 按ID获取体质 */
export function getConstitutionById(id: string): ConstitutionData | undefined {
  return ALL_CONSTITUTIONS.find(c => c.id === id);
}

/** 按性别获取可用体质 */
export function getConstitutionsForGender(gender: string): ConstitutionData[] {
  const genderLower = gender.toLowerCase();
  return [
    ...COMMON_CONSTITUTIONS,
    ...(genderLower === 'male' ? MALE_CONSTITUTIONS : []),
    ...(genderLower === 'female' ? FEMALE_CONSTITUTIONS : []),
  ];
}
