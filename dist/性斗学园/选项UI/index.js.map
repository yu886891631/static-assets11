{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.25_typescript@6.0.0-dev.20250807__webpack@5.103.0/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/external var \"Vue\"","webpack://tavern_helper_template/./src/性斗学园/选项UI/app.vue?933b","webpack://tavern_helper_template/src/性斗学园/选项UI/app.vue?cd7f","src://tavern_helper_template/src/性斗学园/选项UI/index.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = { class: \"option-beautifier\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"options-container\"\n};\nconst _hoisted_3 = [\"onClick\"];\nconst _hoisted_4 = {\n    key: 0,\n    class: \"fight-button-content\"\n};\nconst _hoisted_5 = { class: \"option-label\" };\nconst _hoisted_6 = { class: \"option-content\" };\nconst _hoisted_7 = {\n    key: 1,\n    class: \"no-options\"\n};\nimport { onMounted, ref } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'app',\n    setup(__props) {\n        function get(obj, path, defaultValue) {\n            if (!obj || !path)\n                return defaultValue;\n            const keys = path\n                .replace(/\\[(\\d+)\\]/g, '.$1')\n                .split('.')\n                .filter(Boolean);\n            let result = obj;\n            for (const key of keys) {\n                if (result == null)\n                    return defaultValue;\n                result = result[key];\n            }\n            return result === undefined ? defaultValue : result;\n        }\n        const options = ref([]);\n        const enemyName = ref('');\n        const loadEnemyNameFromMvu = async () => {\n            try {\n                const globalAny = window;\n                if (globalAny.waitGlobalInitialized) {\n                    await globalAny.waitGlobalInitialized('Mvu');\n                }\n                if (!globalAny.Mvu) {\n                    enemyName.value = '';\n                    return;\n                }\n                const mvuData = globalAny.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n                const name = get(mvuData, 'stat_data.性斗系统.对手名称', '');\n                enemyName.value = typeof name === 'string' ? name.trim() : '';\n            }\n            catch (error) {\n                console.error('[选项美化] 获取对手名称失败:', error);\n                enemyName.value = '';\n            }\n        };\n        // 解析选项文本\n        const parseOptions = (text) => {\n            const items = [];\n            // 按行分割\n            const lines = text\n                .split('\\n')\n                .map(line => line.trim())\n                .filter(line => line.length > 0);\n            for (const line of lines) {\n                // 特殊处理：E. 开头的选项为性斗选项\n                if (line.match(/^E\\.\\s*(.+)$/i)) {\n                    const match = line.match(/^E\\.\\s*(.+)$/i);\n                    if (match) {\n                        items.push({\n                            label: 'E',\n                            text: match[1].trim(),\n                            isFight: true,\n                        });\n                        continue; // 跳过后续匹配\n                    }\n                }\n                // 匹配选项格式：\n                // 1. A. 文本\n                // 2. A、文本\n                // 3. A) 文本\n                // 4. (A) 文本\n                let match = line.match(/^([A-Z])\\.\\s*(.+)$/);\n                if (!match) {\n                    match = line.match(/^([A-Z])、\\s*(.+)$/);\n                }\n                if (!match) {\n                    match = line.match(/^([A-Z])\\)\\s*(.+)$/);\n                }\n                if (!match) {\n                    match = line.match(/^\\(([A-Z])\\)\\s*(.+)$/);\n                }\n                if (match) {\n                    items.push({\n                        label: match[1],\n                        text: match[2].trim(),\n                    });\n                }\n            }\n            // 如果没有匹配到标准格式，尝试按序号分割\n            if (items.length === 0) {\n                // 尝试匹配数字序号：1. 2. 3. 等\n                for (let i = 0; i < lines.length; i++) {\n                    const line = lines[i];\n                    const numMatch = line.match(/^(\\d+)\\.\\s*(.+)$/);\n                    if (numMatch) {\n                        // 将数字转换为字母（1->A, 2->B, 3->C...）\n                        const num = parseInt(numMatch[1]);\n                        const label = String.fromCharCode(64 + num); // 65是'A'的ASCII码\n                        items.push({\n                            label: label,\n                            text: numMatch[2].trim(),\n                        });\n                    }\n                }\n            }\n            return items;\n        };\n        // 获取当前消息ID\n        const getCurrentMessageId = () => {\n            try {\n                const globalAny = window;\n                if (globalAny.getCurrentMessageId) {\n                    return globalAny.getCurrentMessageId();\n                }\n                // 备用方法：从URL获取\n                const urlParams = new URLSearchParams(window.location.search);\n                return urlParams.get('message_id') || null;\n            }\n            catch (error) {\n                console.error('[选项美化] 获取消息ID失败:', error);\n                return null;\n            }\n        };\n        // 获取聊天消息\n        const getChatMessages = (messageId) => {\n            try {\n                const globalAny = window;\n                if (globalAny.getChatMessages && messageId) {\n                    return globalAny.getChatMessages(messageId);\n                }\n                // 备用方法：从全局变量获取\n                if (globalAny.chat && globalAny.chat.messages) {\n                    return globalAny.chat.messages;\n                }\n                return [];\n            }\n            catch (error) {\n                console.error('[选项美化] 获取消息失败:', error);\n                return [];\n            }\n        };\n        // 提取并显示选项\n        const extractOptions = () => {\n            try {\n                // 获取当前消息ID\n                const messageId = getCurrentMessageId();\n                // 获取当前消息内容\n                const messages = getChatMessages(messageId);\n                if (messages.length === 0) {\n                    console.warn('[选项美化] 未找到当前消息');\n                    return;\n                }\n                const message = messages[0];\n                const messageText = message.message;\n                // 使用正则表达式提取 <option> 标签中的内容\n                const regex = /<option>([\\s\\S]*?)<\\/option>/;\n                const match = messageText.match(regex);\n                if (match && match[1]) {\n                    const optionText = match[1].trim();\n                    options.value = parseOptions(optionText);\n                    if (!enemyName.value) {\n                        options.value = options.value.filter(o => !o.isFight);\n                    }\n                    console.info('[选项美化] 已提取选项，数量:', options.value.length);\n                }\n                else {\n                    console.info('[选项美化] 未找到 <option> 标签');\n                }\n            }\n            catch (error) {\n                console.error('[选项美化] 提取选项时出错:', error);\n            }\n        };\n        // 触发性斗（使用 /sendas 命令生成一个包含 <fight> 的角色消息楼层，不触发自动回复）\n        const triggerFight = () => {\n            try {\n                const parentWindow = window.parent;\n                const parentAny = parentWindow;\n                const $parent = parentAny.$ || parentAny.jQuery;\n                if (!$parent) {\n                    console.warn('[选项美化] 无法访问父窗口的jQuery');\n                    return;\n                }\n                // 获取当前角色信息\n                const getCharacterInfo = () => {\n                    // 方法1：从 chat 对象获取\n                    if (parentAny.chat) {\n                        const chat = parentAny.chat;\n                        if (chat.characters && chat.characters.length > 0) {\n                            return {\n                                name: chat.characters[0].name || chat.characters[0].title || 'Assistant',\n                                avatar: chat.characters[0].avatar || '',\n                            };\n                        }\n                        if (chat.character) {\n                            return {\n                                name: chat.character.name || chat.character.title || 'Assistant',\n                                avatar: chat.character.avatar || '',\n                            };\n                        }\n                    }\n                    // 方法2：从全局变量获取\n                    if (parentAny.character) {\n                        return {\n                            name: parentAny.character.name || parentAny.character.title || 'Assistant',\n                            avatar: parentAny.character.avatar || '',\n                        };\n                    }\n                    // 方法3：从当前消息中获取角色名\n                    if (parentAny.chat && parentAny.chat.messages && parentAny.chat.messages.length > 0) {\n                        const lastMessage = parentAny.chat.messages[parentAny.chat.messages.length - 1];\n                        if (lastMessage && lastMessage.name && !lastMessage.is_user) {\n                            return {\n                                name: lastMessage.name,\n                                avatar: lastMessage.avatar || '',\n                            };\n                        }\n                    }\n                    // 默认值\n                    return {\n                        name: 'Assistant',\n                        avatar: '',\n                    };\n                };\n                const charInfo = getCharacterInfo();\n                // 方法1：尝试使用 SillyTavern 的命令执行器\n                if (parentAny.executeSlashCommand && typeof parentAny.executeSlashCommand === 'function') {\n                    // 构建 /sendas 命令\n                    const command = `/sendas name=\"${charInfo.name}\"${charInfo.avatar ? ` avatar=\"${charInfo.avatar}\"` : ''} <fight>`;\n                    parentAny.executeSlashCommand(command);\n                    console.info('[选项美化] 已通过 executeSlashCommand 执行 /sendas 命令');\n                    return;\n                }\n                // 方法2：通过输入框执行命令（不触发自动回复）\n                const inputSelectors = [\n                    '#send_textarea',\n                    'textarea[name=\"send_textarea\"]',\n                    '.send_textarea',\n                    'textarea[placeholder*=\"Message\"]',\n                    'textarea[placeholder*=\"消息\"]',\n                    '.chat-input textarea',\n                    '#chat-input textarea',\n                ];\n                let $input = null;\n                for (const selector of inputSelectors) {\n                    $input = $parent(selector);\n                    if ($input.length > 0) {\n                        break;\n                    }\n                }\n                if (!$input || $input.length === 0) {\n                    console.warn('[选项美化] 未找到输入框，无法执行 /sendas 命令');\n                    return;\n                }\n                // 构建 /sendas 命令字符串\n                let command = `/sendas name=\"${charInfo.name}\"`;\n                if (charInfo.avatar) {\n                    command += ` avatar=\"${charInfo.avatar}\"`;\n                }\n                command += ' <fight>';\n                // 设置输入框的值\n                $input.val(command);\n                // 触发 input 和 change 事件\n                $input.trigger('input');\n                $input.trigger('change');\n                // 等待一小段时间确保命令已设置\n                setTimeout(() => {\n                    // 查找发送按钮并点击（这会执行命令但不会触发AI生成）\n                    const sendButtonSelectors = [\n                        '#send_but',\n                        'button[type=\"submit\"]',\n                        '.send-button',\n                        'button.send',\n                        '[data-send-button]',\n                        'button[aria-label*=\"Send\"]',\n                        'button[aria-label*=\"发送\"]',\n                    ];\n                    let $sendButton = null;\n                    for (const selector of sendButtonSelectors) {\n                        $sendButton = $parent(selector);\n                        if ($sendButton.length > 0 && !$sendButton.prop('disabled')) {\n                            break;\n                        }\n                    }\n                    if ($sendButton && $sendButton.length > 0) {\n                        // 点击发送按钮执行命令\n                        $sendButton.trigger('click');\n                        console.info('[选项美化] 已通过发送按钮执行 /sendas 命令');\n                    }\n                    else {\n                        // 如果找不到发送按钮，尝试触发 Enter 键\n                        const inputElement = $input[0];\n                        if (inputElement) {\n                            const enterEvent = new KeyboardEvent('keydown', {\n                                key: 'Enter',\n                                code: 'Enter',\n                                keyCode: 13,\n                                which: 13,\n                                bubbles: true,\n                                cancelable: true,\n                            });\n                            inputElement.dispatchEvent(enterEvent);\n                            console.info('[选项美化] 已通过Enter键执行 /sendas 命令');\n                        }\n                    }\n                }, 50);\n            }\n            catch (error) {\n                console.error('[选项美化] 触发性斗时出错:', error);\n            }\n        };\n        // 选择选项并复制到输入框\n        const selectOption = (optionText) => {\n            try {\n                // 使用 window.parent 访问父窗口\n                const parentWindow = window.parent;\n                const $parent = parentWindow.$ || parentWindow.jQuery;\n                if (!$parent) {\n                    console.warn('[选项美化] 无法访问父窗口的jQuery');\n                    return;\n                }\n                // 查找输入框（尝试多种选择器）\n                const inputSelectors = [\n                    '#send_textarea',\n                    'textarea[name=\"send_textarea\"]',\n                    '.send_textarea',\n                    'textarea[placeholder*=\"Message\"]',\n                    'textarea[placeholder*=\"消息\"]',\n                    '.chat-input textarea',\n                    '#chat-input textarea',\n                ];\n                let $input = null;\n                for (const selector of inputSelectors) {\n                    $input = $parent(selector);\n                    if ($input.length > 0) {\n                        break;\n                    }\n                }\n                if ($input && $input.length > 0) {\n                    // 设置输入框的值\n                    $input.val(optionText);\n                    // 触发 input 事件，确保 Vue/React 等框架能检测到变化\n                    $input.trigger('input');\n                    $input.trigger('change');\n                    // 聚焦输入框\n                    $input.focus();\n                    console.info('[选项美化] 已选择选项:', optionText);\n                }\n                else {\n                    console.warn('[选项美化] 未找到输入框');\n                    // 如果找不到输入框，尝试使用剪贴板API\n                    if (navigator.clipboard) {\n                        navigator.clipboard.writeText(optionText).catch(() => {\n                            console.warn('[选项美化] 复制到剪贴板失败');\n                        });\n                    }\n                }\n            }\n            catch (error) {\n                console.error('[选项美化] 选择选项时出错:', error);\n            }\n        };\n        // 等待全局函数初始化\n        const waitForGlobalFunctions = async (maxRetries = 30, interval = 200) => {\n            const globalAny = window;\n            for (let i = 0; i < maxRetries; i++) {\n                if (typeof globalAny.getChatMessages === 'function' && typeof globalAny.getCurrentMessageId === 'function') {\n                    console.info(`[选项美化] 全局函数已就绪 (第 ${i + 1} 次检查)`);\n                    return true;\n                }\n                await new Promise(resolve => setTimeout(resolve, interval));\n            }\n            console.error('[选项美化] 等待全局函数初始化超时');\n            return false;\n        };\n        onMounted(async () => {\n            console.info('[选项美化] 组件已加载');\n            // 等待全局函数初始化\n            const functionsReady = await waitForGlobalFunctions();\n            if (!functionsReady) {\n                console.error('[选项美化] 全局函数未就绪，无法提取选项');\n                return;\n            }\n            await loadEnemyNameFromMvu();\n            // 提取选项并带重试机制\n            const extractWithRetry = async (retries = 5, delay = 200) => {\n                for (let i = 0; i < retries; i++) {\n                    await new Promise(resolve => setTimeout(resolve, delay));\n                    extractOptions();\n                    if (options.value.length > 0) {\n                        console.info('[选项美化] 成功提取选项，重试次数:', i);\n                        return;\n                    }\n                    // 逐渐增加延迟\n                    delay = Math.min(delay * 1.5, 1000);\n                }\n                console.warn('[选项美化] 多次重试后仍未找到选项');\n            };\n            extractWithRetry();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                (options.value.length > 0)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(options.value, (option, index) => {\n                            return (_openBlock(), _createElementBlock(\"div\", {\n                                key: index,\n                                class: _normalizeClass([\"option-card\", {\n                                        'option-card-hover': true,\n                                        'option-card-fight': option.isFight,\n                                    }]),\n                                onClick: ($event) => (option.isFight ? triggerFight() : selectOption(option.text))\n                            }, [\n                                _createCommentVNode(\" 性斗按钮特殊显示 \"),\n                                (option.isFight)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [...(_cache[0] || (_cache[0] = [\n                                            _createElementVNode(\"div\", { class: \"fight-button-text\" }, \"【发起性斗】\", -1 /* CACHED */)\n                                        ]))]))\n                                    : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                        _createCommentVNode(\" 普通选项显示 \"),\n                                        _createCommentVNode(\" 选项标签 \"),\n                                        _createElementVNode(\"div\", _hoisted_5, _toDisplayString(option.label), 1 /* TEXT */),\n                                        _createCommentVNode(\" 选项内容 \"),\n                                        _createElementVNode(\"div\", _hoisted_6, _toDisplayString(option.text), 1 /* TEXT */),\n                                        _createCommentVNode(\" 点击提示 \"),\n                                        _cache[1] || (_cache[1] = _createElementVNode(\"div\", { class: \"option-hint\" }, [\n                                            _createElementVNode(\"i\", { class: \"fas fa-mouse-pointer\" }),\n                                            _createTextVNode(\" 点击选择 \")\n                                        ], -1 /* CACHED */))\n                                    ], 64 /* STABLE_FRAGMENT */))\n                            ], 10 /* CLASS, PROPS */, _hoisted_3));\n                        }), 128 /* KEYED_FRAGMENT */))\n                    ]))\n                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [...(_cache[2] || (_cache[2] = [\n                            _createElementVNode(\"p\", null, \"未找到选项内容\", -1 /* CACHED */)\n                        ]))]))\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./app.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./app.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./app.vue?vue&type=style&index=0&id=50d13ef0&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.25_typescript@6.0.0-dev.20250807__webpack@5.103.0/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-50d13ef0\"]])\n\nexport default __exports__","import { createApp } from 'vue';\nimport app from './app.vue';\n\n$(() => {\n  createApp(app).mount('#app');\n});\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","Vue","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","__name","setup","__props","options","ref","enemyName","loadEnemyNameFromMvu","async","globalAny","window","waitGlobalInitialized","Mvu","value","name","obj","path","defaultValue","keys","replace","split","filter","Boolean","result","undefined","get","getMvuData","type","message_id","trim","error","console","extractOptions","messages","messageId","getChatMessages","chat","getCurrentMessageId","URLSearchParams","location","search","length","warn","messageText","message","regex","match","optionText","text","items","lines","map","line","push","label","isFight","i","numMatch","num","parseInt","String","fromCharCode","parseOptions","o","info","onMounted","maxRetries","interval","Promise","resolve","setTimeout","waitForGlobalFunctions","retries","delay","Math","min","extractWithRetry","_ctx","_cache","option","index","onClick","$event","parentAny","parent","$parent","$","jQuery","charInfo","characters","title","avatar","character","lastMessage","is_user","getCharacterInfo","executeSlashCommand","command","inputSelectors","$input","selector","trigger","sendButtonSelectors","$sendButton","prop","inputElement","enterEvent","KeyboardEvent","code","keyCode","which","bubbles","cancelable","dispatchEvent","triggerFight","parentWindow","focus","navigator","clipboard","writeText","catch","selectOption","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__","createApp","app","mount"],"ignoreList":[],"sourceRoot":""}