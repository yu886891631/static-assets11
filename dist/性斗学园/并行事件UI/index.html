<head><script type="module">var e={426:(e,t)=>{t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,a]of t)n[e]=a;return n}}},t={};const n=Vue,a={class:'event-count'},r={class:'events-list'},o={class:'event-character'},s={class:'character-name'},l={class:'event-description'},c={key:1,class:'no-events'},i=(0,n.defineComponent)({__name:'app',setup(e){const t=/<parallel>([\s\S]*?)<\/parallel>/g,i=(0,n.ref)([]),u=(0,n.ref)(!0),m=(0,n.ref)({字体大小:'0.95rem',内边距:'1.5rem',字符名颜色:'#ec4899',描述颜色:'#e5e7eb',行间距:'1rem'}),d=(0,n.computed)(()=>({width:'100%',margin:'0',padding:'0'})),v=(0,n.computed)(()=>({marginBottom:m.value.行间距,fontSize:m.value.字体大小})),p=()=>{try{const e=window;return e.getAllVariables?e.getAllVariables():{}}catch(e){return console.error('[并行事件UI] 获取变量失败:',e),{}}},f=()=>{try{const e=p()['并行事件UI配置']||{};e['折叠状态']=u.value,((e,t)=>{try{const n=window;n.insertOrAssignVariables&&n.insertOrAssignVariables(e,t)}catch(e){console.error('[并行事件UI] 保存变量失败:',e)}})({并行事件UI配置:e},{type:'chat'}),console.info('[并行事件UI] 折叠状态已保存:',u.value)}catch(e){console.error('[并行事件UI] 保存折叠状态失败:',e)}},g=()=>{u.value=!u.value,f()},h=()=>{try{const e=(e=>{try{const t=window;return t.getChatMessages&&e?t.getChatMessages(e):t.chat&&t.chat.messages?t.chat.messages:[]}catch(e){return console.error('[并行事件UI] 获取消息失败:',e),[]}})((()=>{try{const e=window;return e.getCurrentMessageId?e.getCurrentMessageId():new URLSearchParams(window.location.search).get('message_id')||null}catch(e){return console.error('[并行事件UI] 获取消息ID失败:',e),null}})());if(0===e.length)return void console.warn('[并行事件UI] 未找到当前消息');const n=e[0].message||'',a=Array.from(n.matchAll(t));if(a.length>0){const e=a[a.length-1],t=(e=>{const t=[],n=e.split('\n').map(e=>e.trim()).filter(e=>e.length>0);for(const e of n){const n=e.match(/^\[([^\|\[\]]+)\s*\|\s*(.+)\]$/);if(n){const e=n[1].trim(),a=n[2].trim();e&&a&&t.push({character:e,description:a})}}return t})(e[1].trim());i.value=t,console.info('[并行事件UI] 已提取并行事件，数量:',t.length)}else i.value=[],console.info('[并行事件UI] 未找到 <parallel> 标签')}catch(e){console.error('[并行事件UI] 提取并行事件时出错:',e),i.value=[]}};return(0,n.onMounted)(async()=>{console.info('[并行事件UI] 组件已加载');const e=await(async(e=30,t=200)=>{const n=window;for(let a=0;a<e;a++){if('function'==typeof n.getChatMessages&&'function'==typeof n.getCurrentMessageId)return console.info(`[并行事件UI] 全局函数已就绪 (第 ${a+1} 次检查)`),!0;await new Promise(e=>setTimeout(e,t))}return console.error('[并行事件UI] 等待全局函数初始化超时'),!1})();if(!e)return void console.error('[并行事件UI] 全局函数未就绪，无法提取事件');(()=>{try{const e=(p()['并行事件UI配置']||{})['折叠状态'];u.value=void 0===e||!0===e,console.info('[并行事件UI] 折叠状态已加载:',u.value)}catch(e){console.warn('[并行事件UI] 加载折叠状态失败，使用默认值:',e),u.value=!0}})(),setTimeout(()=>{h()},100);const t=window;t.eventOn&&t.eventOn('messageUpdated',()=>{setTimeout(()=>{h()},100)})}),(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{class:'parallel-events-beautifier',style:(0,n.normalizeStyle)(d.value)},[i.value.length>0?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:(0,n.normalizeClass)(['beautified-events-wrapper',{collapsed:u.value}])},[(0,n.createCommentVNode)(' 装饰性渐变背景 '),t[3]||(t[3]=(0,n.createElementVNode)('div',{class:'gradient-overlay'},null,-1)),t[4]||(t[4]=(0,n.createElementVNode)('div',{class:'shimmer-effect'},null,-1)),(0,n.createCommentVNode)(' 标题（可点击折叠） '),(0,n.createElementVNode)('div',{class:'events-header',onClick:g},[t[0]||(t[0]=(0,n.createElementVNode)('i',{class:'fas fa-stream'},null,-1)),t[1]||(t[1]=(0,n.createElementVNode)('span',null,'并行事件',-1)),(0,n.createElementVNode)('i',{class:(0,n.normalizeClass)(['fas collapse-icon',u.value?'fa-chevron-down':'fa-chevron-up'])},null,2),(0,n.createElementVNode)('span',a,'('+(0,n.toDisplayString)(i.value.length)+')',1)]),(0,n.createCommentVNode)(' 事件列表（可折叠） '),(0,n.withDirectives)((0,n.createElementVNode)('div',r,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.value,(e,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:a,class:'event-item',style:(0,n.normalizeStyle)(v.value)},[(0,n.createElementVNode)('div',o,[t[2]||(t[2]=(0,n.createElementVNode)('i',{class:'fas fa-user-circle'},null,-1)),(0,n.createElementVNode)('span',s,(0,n.toDisplayString)(e.character),1)]),(0,n.createElementVNode)('div',l,(0,n.toDisplayString)(e.description),1)],4))),128))],512),[[n.vShow,!u.value]])],2)):((0,n.openBlock)(),(0,n.createElementBlock)('div',c,[...t[5]||(t[5]=[(0,n.createElementVNode)('p',null,'未找到并行事件',-1)])]))],4))}});var u=function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}(426);const m=(0,u.A)(i,[['__scopeId','data-v-4f2683aa']]);$(()=>{(0,n.createApp)(m).mount('#app')});
//# sourceMappingURL=index.js.map</script><style>.parallel-events-beautifier[data-v-4f2683aa]{width:100%;margin:0;padding:0}.beautified-events-wrapper[data-v-4f2683aa]{position:relative;margin:0 auto;padding:1.5rem;border-radius:1rem;overflow:hidden;background:linear-gradient(135deg,rgba(99,102,241,0.1) 0%,rgba(236,72,153,0.1) 100%);border:1px solid hsla(0,0%,100%,.15);backdrop-filter:blur(20px) saturate(180%);box-shadow:0 8px 32px rgba(0,0,0,.3),0 2px 8px rgba(99,102,241,.2),inset 0 1px 0 hsla(0,0%,100%,.1);transition:all .4s cubic-bezier(0.4,0,0.2,1);width:100%}.beautified-events-wrapper.collapsed[data-v-4f2683aa]{padding:.75rem 1.5rem}.beautified-events-wrapper.collapsed .events-header[data-v-4f2683aa]{margin-bottom:0;padding-bottom:0;border-bottom:none}.beautified-events-wrapper[data-v-4f2683aa]::before{content:"";position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent 0%,rgba(99,102,241,0.5) 25%,rgba(236,72,153,0.5) 75%,transparent 100%);opacity:0;transition:opacity .4s ease}.beautified-events-wrapper[data-v-4f2683aa]:hover{background:linear-gradient(135deg,rgba(99,102,241,0.15) 0%,rgba(236,72,153,0.15) 100%);border-color:rgba(236,72,153,.4);box-shadow:0 12px 48px rgba(0,0,0,.4),0 4px 16px rgba(99,102,241,.3),inset 0 1px 0 hsla(0,0%,100%,.15);transform:translateY(-2px)}.beautified-events-wrapper[data-v-4f2683aa]:hover::before{opacity:1}.beautified-events-wrapper:hover .gradient-overlay[data-v-4f2683aa]{opacity:.3}.beautified-events-wrapper:hover .shimmer-effect[data-v-4f2683aa]{animation:shimmer-4f2683aa 3s infinite}.gradient-overlay[data-v-4f2683aa]{position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 30% 20%,rgba(99,102,241,0.2) 0%,transparent 50%),radial-gradient(circle at 70% 80%,rgba(236,72,153,0.2) 0%,transparent 50%);opacity:.2;transition:opacity .4s ease;pointer-events:none;z-index:0}.shimmer-effect[data-v-4f2683aa]{position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,0.1) 50%,transparent 100%);pointer-events:none;z-index:1}@keyframes shimmer-4f2683aa{0%{left:-100%}100%{left:100%}}.events-header[data-v-4f2683aa]{position:relative;z-index:2;display:flex;align-items:center;gap:.75rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid hsla(0,0%,100%,.1);cursor:pointer;-webkit-user-select:none;user-select:none;transition:all .3s ease}.events-header[data-v-4f2683aa]:hover{opacity:.9}.events-header:hover .collapse-icon[data-v-4f2683aa]{transform:scale(1.1)}.events-header i[data-v-4f2683aa]:not(.collapse-icon){color:#6366f1;font-size:1.25rem;flex-shrink:0}.events-header span[data-v-4f2683aa]:not(.event-count){color:#fff;font-size:1.1rem;font-weight:600;background:linear-gradient(135deg,#6366f1 0%,#ec4899 50%,#8b5cf6 100%);-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0);background-clip:text;text-shadow:0 2px 4px rgba(99,102,241,.3);flex:1}.events-header .collapse-icon[data-v-4f2683aa]{color:#6366f1;font-size:.9rem;margin-left:auto;transition:transform .3s ease;flex-shrink:0}.events-header .event-count[data-v-4f2683aa]{color:#9ca3af;font-size:.85rem;font-weight:500;flex-shrink:0}.events-list[data-v-4f2683aa]{position:relative;z-index:2}.event-item[data-v-4f2683aa]{display:flex;flex-direction:column;gap:.5rem;padding:1rem;margin-bottom:1rem;background:linear-gradient(135deg,rgba(99,102,241,0.08) 0%,rgba(236,72,153,0.08) 100%);border:1px solid hsla(0,0%,100%,.1);border-radius:.75rem;transition:all .3s ease}.event-item[data-v-4f2683aa]:last-child{margin-bottom:0}.event-item[data-v-4f2683aa]:hover{background:linear-gradient(135deg,rgba(99,102,241,0.15) 0%,rgba(236,72,153,0.15) 100%);border-color:rgba(236,72,153,.3);transform:translateX(4px);box-shadow:0 4px 12px rgba(0,0,0,.2),0 2px 4px rgba(99,102,241,.2)}.event-character[data-v-4f2683aa]{display:flex;align-items:center;gap:.5rem}.event-character i[data-v-4f2683aa]{color:#6366f1;font-size:1rem;flex-shrink:0}.event-character .character-name[data-v-4f2683aa]{color:#ec4899;font-weight:600;font-size:.95rem;text-shadow:0 1px 2px rgba(236,72,153,.3)}.event-description[data-v-4f2683aa]{color:#e5e7eb;line-height:1.6;padding-left:1.5rem;text-shadow:0 1px 2px rgba(0,0,0,.3);word-wrap:break-word;overflow-wrap:break-word}.no-events[data-v-4f2683aa]{padding:2rem;text-align:center;color:#9ca3af;font-size:.9rem}@media (max-width:768px){.beautified-events-wrapper[data-v-4f2683aa]{padding:1rem;border-radius:.75rem}.beautified-events-wrapper.collapsed[data-v-4f2683aa]{padding:.5rem 1rem}.events-header[data-v-4f2683aa]{font-size:1rem;margin-bottom:1rem;padding-bottom:.75rem;gap:.5rem}.events-header span[data-v-4f2683aa]:not(.event-count){font-size:1rem}.events-header .event-count[data-v-4f2683aa]{font-size:.8rem}.event-item[data-v-4f2683aa]{padding:.75rem;margin-bottom:.75rem}.event-description[data-v-4f2683aa]{padding-left:1.25rem;font-size:.9rem}}

/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body>