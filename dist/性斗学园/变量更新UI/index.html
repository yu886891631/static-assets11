<head><script type="module">var e={426:(e,a)=>{a.A=(e,a)=>{const s=e.__vccOpts||e;for(const[e,n]of a)s[e]=n;return s}}},a={};const s=Vue,n={class:'variable-update-beautifier'},t={key:0,class:'update-container'},r={class:'header-left'},c={class:'update-content'},l=['innerHTML'],o={key:1,class:'no-update'},i=(0,s.defineComponent)({__name:'app',setup(e){const a=(0,s.ref)(''),i=(0,s.ref)(!1),d=(0,s.computed)(()=>{if(!a.value)return'';let e=a.value;return e=e.replace(/<Analysis>([\s\S]*?)<\/Analysis>/gi,(e,a)=>`\n        <div class="analysis-section">\n          <div class="section-header">\n            <i class="fas fa-search"></i>\n            <span>分析</span>\n          </div>\n          <div class="section-content">\n            ${p(a.trim())}\n          </div>\n        </div>\n      `),e=e.replace(/<JSONPatch>([\s\S]*?)<\/JSONPatch>/gi,(e,a)=>`\n        <div class="jsonpatch-section">\n          <div class="section-header">\n            <i class="fas fa-code"></i>\n            <span> 变量更新代码 </span>\n          </div>\n          <div class="section-content">\n            ${u(a.trim())}\n          </div>\n        </div>\n      `),e}),p=e=>{let a=e.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');return a=a.replace(/^- (.+)$/gm,'<div class="analysis-item">• $1</div>'),a=a.replace(/^  - (.+)$/gm,'<div class="analysis-subitem">  • $1</div>'),a=a.replace(/\n/g,'<br>'),a},u=e=>{try{const a=JSON.parse(e),s=JSON.stringify(a,null,2);return v(s)}catch(a){return`<pre class="json-error">${m(e)}</pre>`}},v=e=>{let a=m(e);return a=a.replace(/"op"\s*:\s*"([^"]+)"/g,'<span class="json-key">"op"</span>: <span class="json-op">"$1"</span>'),a=a.replace(/"([^"]+)"\s*:/g,(e,a)=>'op'===a?e:`<span class="json-key">"${a}"</span>:`),a=a.replace(/:\s*"([^"]+)"/g,': <span class="json-string">"$1"</span>'),a=a.replace(/\[\s*"([^"]+)"\s*\]/g,'[<span class="json-string">"$1"</span>]'),a=a.replace(/"([^"]+)",/g,'<span class="json-string">"$1"</span>,'),a=a.replace(/:\s*(\d+)/g,': <span class="json-number">$1</span>'),a=a.replace(/:\s*(true|false)/g,': <span class="json-boolean">$1</span>'),a=a.replace(/:\s*(null)/g,': <span class="json-null">$1</span>'),`<pre class="json-code">${a}</pre>`},m=e=>e.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'),g=()=>{i.value=!i.value},h=()=>{try{const e=(e=>{try{const a=window;return a.getChatMessages&&e?a.getChatMessages(e):a.chat&&a.chat.messages?a.chat.messages:[]}catch(e){return console.error('[变量更新] 获取消息失败:',e),[]}})((()=>{try{const e=window;return e.getCurrentMessageId?e.getCurrentMessageId():new URLSearchParams(window.location.search).get('message_id')||null}catch(e){return console.error('[变量更新] 获取消息ID失败:',e),null}})());if(0===e.length)return void console.warn('[变量更新] 未找到当前消息');const s=e[0].message,n=/<UpdateVariable>([\s\S]*?)<\/UpdateVariable>/gi,t=/<update>([\s\S]*?)<\/update>/gi,r=Array.from(s.matchAll(n)),c=Array.from(s.matchAll(t)),l=[];if(r.forEach(e=>{void 0!==e.index&&l.push({content:e[1],index:e.index})}),c.forEach(e=>{void 0!==e.index&&l.push({content:e[1],index:e.index})}),l.length>0){l.sort((e,a)=>e.index-a.index);const e=l[l.length-1].content.trim();let s='';const n=e.match(/<Analysis>([\s\S]*?)<\/Analysis>/i);n&&n[1]&&(s+=`<Analysis>${n[1].trim()}</Analysis>\n\n`);const t=e.match(/<JSONPatch>([\s\S]*?)<\/JSONPatch>/i);t&&t[1]&&(s+=`<JSONPatch>${t[1].trim()}</JSONPatch>`),s.trim()?(a.value=s.trim(),console.info('[变量更新] 已提取更新内容，长度:',a.value.length)):(a.value='',console.info('[变量更新] 未找到 <Analysis> 或 <JSONPatch> 标签'))}else a.value='',console.info('[变量更新] 未找到 <UpdateVariable> 或 <update> 标签')}catch(e){console.error('[变量更新] 提取内容时出错:',e),a.value=''}};return(0,s.onMounted)(async()=>{console.info('[变量更新] 组件已加载');await(async(e=30,a=200)=>{const s=window;for(let n=0;n<e;n++){if('function'==typeof s.getChatMessages&&'function'==typeof s.getCurrentMessageId)return console.info(`[变量更新] 全局函数已就绪 (第 ${n+1} 次检查)`),!0;await new Promise(e=>setTimeout(e,a))}return console.error('[变量更新] 等待全局函数初始化超时'),!1})()?setTimeout(()=>{h()},100):console.error('[变量更新] 全局函数未就绪，无法提取内容')}),(e,p)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',n,[a.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',t,[(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['update-card',{'is-expanded':i.value}])},[(0,s.createCommentVNode)(' 折叠栏头部 '),(0,s.createElementVNode)('div',{class:'update-header',onClick:g},[(0,s.createElementVNode)('div',r,[(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['expand-icon',{rotated:i.value}])},[...p[0]||(p[0]=[(0,s.createElementVNode)('i',{class:'fas fa-chevron-down'},null,-1)])],2),p[1]||(p[1]=(0,s.createElementVNode)('div',{class:'header-title'},[(0,s.createElementVNode)('i',{class:'fas fa-sync-alt'}),(0,s.createElementVNode)('span',null,'变量更新')],-1))]),p[2]||(p[2]=(0,s.createElementVNode)('div',{class:'header-badge'},[(0,s.createElementVNode)('i',{class:'fas fa-code'})],-1))]),(0,s.createCommentVNode)(' 折叠内容 '),(0,s.withDirectives)((0,s.createElementVNode)('div',c,[(0,s.createElementVNode)('div',{class:'content-wrapper',innerHTML:d.value},null,8,l)],512),[[s.vShow,i.value]])],2)])):((0,s.openBlock)(),(0,s.createElementBlock)('div',o,[...p[3]||(p[3]=[(0,s.createElementVNode)('p',null,'未找到变量更新内容',-1)])]))]))}});var d=function s(n){var t=a[n];if(void 0!==t)return t.exports;var r=a[n]={exports:{}};return e[n](r,r.exports,s),r.exports}(426);const p=(0,d.A)(i,[['__scopeId','data-v-65e20715']]);$(()=>{(0,s.createApp)(p).mount('#app')});
//# sourceMappingURL=index.js.map</script><style>.variable-update-beautifier[data-v-65e20715]{width:100%;margin:0;padding:0}.update-container[data-v-65e20715]{margin:1rem 0}.update-card[data-v-65e20715]{background:linear-gradient(135deg,rgba(99,102,241,0.1) 0%,rgba(236,72,153,0.1) 100%);border:1px solid hsla(0,0%,100%,.15);border-radius:.75rem;overflow:hidden;backdrop-filter:blur(20px) saturate(180%);box-shadow:0 4px 16px rgba(0,0,0,.2),0 2px 4px rgba(99,102,241,.15),inset 0 1px 0 hsla(0,0%,100%,.1);transition:all .3s cubic-bezier(0.4,0,0.2,1);background-image:radial-gradient(circle at 20% 30%,rgba(99,102,241,0.15) 0%,transparent 50%),radial-gradient(circle at 80% 70%,rgba(236,72,153,0.15) 0%,transparent 50%)}.update-card.is-expanded[data-v-65e20715]{border-color:rgba(236,72,153,.3);box-shadow:0 8px 24px rgba(0,0,0,.3),0 4px 8px rgba(99,102,241,.2),inset 0 1px 0 hsla(0,0%,100%,.15)}.update-header[data-v-65e20715]{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.25rem;cursor:pointer;-webkit-user-select:none;user-select:none;transition:all .2s ease}.update-header[data-v-65e20715]:hover{background:hsla(0,0%,100%,.05)}.update-header .header-left[data-v-65e20715]{display:flex;align-items:center;gap:.75rem;flex:1}.update-header .expand-icon[data-v-65e20715]{width:1.5rem;height:1.5rem;display:flex;align-items:center;justify-content:center;color:#6366f1;transition:transform .3s cubic-bezier(0.4,0,0.2,1)}.update-header .expand-icon.rotated[data-v-65e20715]{transform:rotate(180deg)}.update-header .header-title[data-v-65e20715]{display:flex;align-items:center;gap:.5rem;color:#e5e7eb;font-weight:600;font-size:1rem}.update-header .header-title i[data-v-65e20715]{color:#6366f1}.update-header .header-badge[data-v-65e20715]{width:2rem;height:2rem;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(99,102,241,0.3) 0%,rgba(236,72,153,0.3) 100%);border-radius:50%;color:#6366f1;font-size:.9rem}.update-content[data-v-65e20715]{border-top:1px solid hsla(0,0%,100%,.1);padding:1.5rem;animation:slideDown-65e20715 .3s cubic-bezier(0.4,0,0.2,1)}@keyframes slideDown-65e20715{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.content-wrapper[data-v-65e20715]{color:#e5e7eb;font-size:.95rem;line-height:1.7}.content-wrapper[data-v-65e20715] .analysis-section,.content-wrapper[data-v-65e20715] .jsonpatch-section{margin-bottom:1.5rem}.content-wrapper[data-v-65e20715] .analysis-section:last-child,.content-wrapper[data-v-65e20715] .jsonpatch-section:last-child{margin-bottom:0}.content-wrapper[data-v-65e20715] .section-header{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;padding-bottom:.5rem;border-bottom:2px solid rgba(99,102,241,.3);color:#ec4899;font-weight:600;font-size:1rem}.content-wrapper[data-v-65e20715] .section-header i{color:#6366f1}.content-wrapper[data-v-65e20715] .section-content{color:#d1d5db}.content-wrapper[data-v-65e20715] .analysis-item{margin:.1rem 0;padding-left:1rem;color:#e5e7eb;line-height:1}.content-wrapper[data-v-65e20715] .analysis-subitem{margin:.15rem 0;padding-left:2rem;color:#cbd5e1;font-size:.9em;line-height:1.4}.content-wrapper[data-v-65e20715] .json-code{margin:.75rem 0;padding:1rem;background:rgba(0,0,0,.3);border-radius:.5rem;overflow-x:auto;border:1px solid hsla(0,0%,100%,.1);font-family:"Fira Code","Courier New","Consolas",monospace;font-size:.85rem;line-height:1.6}.content-wrapper[data-v-65e20715] .json-code .json-key{color:#6366f1;font-weight:600}.content-wrapper[data-v-65e20715] .json-code .json-string{color:#10b981}.content-wrapper[data-v-65e20715] .json-code .json-number{color:#f59e0b}.content-wrapper[data-v-65e20715] .json-code .json-boolean{color:#ec4899}.content-wrapper[data-v-65e20715] .json-code .json-null{color:#9ca3af}.content-wrapper[data-v-65e20715] .json-code .json-op{color:#8b5cf6;font-weight:600}.content-wrapper[data-v-65e20715] .json-error{margin:.75rem 0;padding:1rem;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);border-radius:.5rem;color:#fca5a5;font-family:"Courier New",monospace;font-size:.85rem;white-space:pre-wrap}.no-update[data-v-65e20715]{padding:2rem;text-align:center;color:#9ca3af;font-size:.9rem}.no-update p[data-v-65e20715]{margin:0}

/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body>